## Intro

스프링은 뭘까?

스프링은 기본적으로 IoC와 DI를 위 한 컨테이너로서 동작하지만 그렇다고 `“스프링은 단지 IoC/DI 프레임워크다”`라고는 말 할 수 없다.

IoC/DI를 편하게 적용하도록 돕는 단계를 넘어서 엔터프라이즈 애플리케이션 개발의 전 영역에 걸쳐 다양한 종류의 기술

## 8.1 스프링의 정의

스프링의 정의를 통해 스프링이 어떤 것인지 큰 그림을 이해해보는 것이 중요하다.

> 스프링의 정의
>

자바 엔터프라이즈 개발을 편하게 해주는 오픈소스 경량급 애플리케이션 프레임워크

> 정의의 해석
>

- 애플리케이션 프레임워크

일반적으로 라이브러리나 프레임워크는 특정 업무 분야나 한 가지 기술에 특화된 목표를 가지고 만들어진다.

예를 들어 웹 계층을 MVC 구조로 손쉽게 만들 수 있게 한다거나, 포맷과 출력장치를 유연하게 변경할 수 있는 애플리케이션 `로그 기능`을 제공한다거나, 간단한 설정만으로 관계형 DB와 자바 오브젝트를
매핑해주는 `ORM 기술`을 제공하는 것들이다.

하지만 스프링은 `애플리케이션 프레임워크`라는 특징을 갖는다.

애플리케이션 프레임워크는 `특정 계층`이나, `기술`, `업무 분야`에 국한되지 않고 애플리케이션의 전 영역에 포괄하는 범용적인 프레임워크를 말한다.

애플리케이션 프레임워크는 애플리케이션 개발의 전 과정을 빠르고 편리하며 효율적으로 진행하는 데 일차적인 목표를 갖는 프레임워크이다.

스프링을 애플리케이션 프레임워크라 불리는 이유는

단순하게 여러 계층의 다양한 기술을 한데 모아뒀기 때문에 애플리케이션 프레임워크로 불리는 것이 아니라 애플리케이션 전 영역을 관통하는 일관된 프로그래밍 모델과 핵심 기술을 바탕으로 해서 각 분야의 특성에 맞는
요구사항을 채워주기 때문에, 애플리케이션을 빠르고 효과적으로 개발할 수 있다.

스프링의 IoC / DI 프레임워크나 AOP은 `핵심 기술`이고 그 핵심 기술에 담긴 프로그래밍 모델을 일관되게 적용해서 엔터프라이즈 애플리케이션 전 계층과 전 영역에 `전략`과 `기능`을
제공해줌으로써 애플리케이션을 편하게 개발하게 해주는 애플리케이션 프레임워크로 사용되는 것이 스프링의 일차적인 존재 목적이다.

- 경량급

경량급이라는 표현을 쓴 것은 코드 자체가 아주 가볍다거나 작은 규모의 코드로 이루어졌다는 것이 아니라 스프링을 기반으로 제작되는 코드가 기존의 EJB이나 여타 프레임워크에서 동작하기 위해 만들어진 코드에 비해
상대적으로 작고 단순하다는 뜻이기도 하다.

같은 기능을 수행하는 코드임에도 스프링 기반의 코드가 가벼운 이유는 코드에 불필요하게 등장하던, 프레임워크와 서버환경에 의존적인 부분을 제거해주기 때문이다.

만들어진 코드가 지원하는 기술수준은 비슷하더라도 훨씬 빠르고 간편하게 작성하게 해줌으로써 생산성과 품질 면에서 유리하다는 것이 경량급이라는 말로 표현되는 스프링의 특징이다.

- 자바 엔터프라이즈 개발을 편하게

스프링은 근본적인 부분에서 엔터프라이즈 개발의 `복잡함을 제거`하고, 진정으로 개발을 편하게 해주는 해결책을 제시한다.

엔터프라이즈 개발의 `근본적인 문제점`에 도전해서 해결책을 제시한다는 것이 기존 기술의 접근 방법과 스프링의 접근 방법의 차이점이다.

`편리한 애플리케이션 개발`이란 개발자가 복잡하고 실수하기 쉬운 로우레벨 기술에 많은 신경을 쓰지 않으면서도 애플리케이션의 핵심인 사용자의 요구사항, 즉 비즈니스 로직을 빠르고 효과적으로 구현하는 것을
말한다.

애플리케이션 개발자들이 스프링이라는 프레임워크가 제공하는 기술이 아니라 자신이 작성하는 애플리케이션의 로직에 더 많은 관심과 시간을 쏟을 수 있도록 돕는다.

- 오픈소스

오픈소스란 말 그대로 소스가 모두에게 공개되고 특별한 라이선스를 취득할 필요없이 얼마든지 가져다 자유롭게 이용해도 된다는 뜻이다.

스프링에 적용된 오픈소스 라이선스는 오픈소스 라이선스 중에서도 비교적 제약이 적고 사용이 매우 자유로운 편인 아파치 라이선스 버전2.0이다.

아파치 라이선스에 따르면 스프링을 상업적인 목적의 제품에 포함시키거나 비공개 프로젝트에 자유롭게 이용해도 된다. 다만 스프링을 사용한다는 점과 원 저작자를 밝히고 제품을 패커징할 때 라이선스 정보를 포함시키는 등의
기본적인 의무사항을 따르면 된다.

또한 필요한 경우 스프링 소스코드를 가져와 수정해서 사용할 수 있고, 수정을 했더라도 수정한 소스를 공개해야 하는 의무는 없다.

스프링은 대부분의 오픈소스 프로젝트처럼 스프링도 오픈소스 개발과 사용자를 위한 온라인 커뮤니티가 있다.

커뮤니티를 통해 자유롭게 개발에 관한 의견을 공유하거나 토론할 수도 있고 자신이 발견한 버그를 신고하거나 새로운 기능을 추가해달라고 요청 할 수도 있다. 그런 요청이나 버그 신고가 어떻게 처리되고 있는지도 이슈트래커
시스템을 통해 공개적으로 확인이 가능하며, 수정된 코드도 언제든지 살펴볼 수 있다.

기존 오픈소스 개발 방식의 단점을 극복할 수 있는 대안은 기업이나 기관의 지원을 받는 전문 개발자가 오픈소스 개발을 책임지게 하는 것이다.

스프링을 개발하는 SpringSource는 스프링에 대한 전문적인 기술지원과 컨설팅, 스프링을 기반으로 개발된 시스템을 안정적으로 운용할 수 있도록 돕는 상용 제품을 제공함으로써 수익을 얻고, 한편으로는 오픈소스
프로젝트로서 스프링이 효율적으로 개발되도록 지원하다.

스프링은 오픈소스의 장점을 충분히 취하면서 동시에 오픈소스 제품의 단점과 한계를 잘 극복하고 있는, 전문적이고 성공적인 오픈소스 소프트웨어라고 할 수 있다.

---

## 8.2 스프링의 목적

스프링의 개발 철학과 궁극적인 목표가 무엇인지 생각해볼때이다.

스프링은 목표를 분명히 알고 사용하지 않으면 그 가치를 제대로 얻기 힘들다.

스프링을 사용하기는 해도 스프링이 주는 혜택을 전혀 누리지 못하고 오히려 사용하지 않느니만 못한 경우도 적지 않다.

스프링은 그 기능과 API 시용 방법을 잘 안다고 해서 잘 쓸수 있는 게 아니다.

스프링도 목적을 바로 이해하고 그 목적을 이루는 도구로 스프링을 잘 활용해야만 스프링으로부터 제대로 된 가치를 얻을 수 있다.

### 8.2.1 엔터프라이즈 개발의 복잡함

엔터프라이즈 프로젝트 개발은 실패할 확률이 높은데 그 이유는 엔터프라이즈 시스템 개발이 너무 복잡하기 때문이라고 한다.

> 복잡함의 근본적인 이유
>

엔터프라이즈 시스템 개발이 복잡한 이유는 크게 두 가지가 있다고 한다.

- 첫 번째는 기술적인 제약 조건과 요구사항이 늘어가기 때문이다.

엔터프라이즈 시스템이란 서버에서 동작하며 기업과 조직의 업무를 처리해주는 시스템을 말한다.

엔터프라이즈 시스템은 서버의 자원을 효율적으로 공유하고 분배해서 사용해야하고, 보안과 안정성, 확장성 면에서도 뛰어나야 하며, 뛰어난 성능과 서비스의 안정성에 대해 고려한 개발 기술이 필요하다.

즉, 엔터프라이즈 시스템을 개발하는데에 비즈니스 로직을 구현하는 것도 중요하지만 기술적으로 고려해야 할 사항이 많다.

- 엔터프라이즈 애플리케이선이 구현해야 할 핵심기능인 비즈니스 로직의 복잡함이 증가하기 때문이다.

서비스의 변화를 소비자에게 맞추기 위해 업계는 수시로 업무 프로세스를 변경하고 조정하는 것을 상시화할 만큼 변화의 속도가 빨라 졌다.

이러한 업무 구조와 프로세스의 변화를 뒷받침 해주기 위해 엔터프라이즈 시스템의 변경을 요구할 수 밖에 없고, 이전과 다르게 시스템 개발과 유지보, 추가 개발 등의 작업에 대한 부담이 커지고 그에 따른 개발 난이도가
더욱 증가하게 되었다.

> 복잡함을 가중시키는 원인
>

엔터프라이즈 애플리케이션 개발이 실패하는 주요 원인은 `비즈니스 로직의 복잡함`과 `기술적인 복잡함`이다.

### 8.2.2 복잡함을 해결하려는 도전

> 제거될 수 없는 근본적인 복잡함
>

엔터프라이즈 개발의 근본적인 복잡함의 원인은 제거할 대상은 아니다.

복잡함을 효과적으로 상대할 수 있는 전략과 기법이 필요하다.

문제는 비즈니스 로직의 복잡함을 효과적으로 다루기 위한 방법과 기술적인 복잡함을 효과적으로 처리하는 데 적용되는 방법이 다르다는 점이다.

따라서 가장 먼저 할 일은 성격이 다른 이 두 가지 복잡함을 분리해내는 것이다.

> 실패한 해결책: EJB
>

EJB가 처음 등장했을 때 내세웠던 목표를 봐도 알 수 있듯이 EJB의 기본 전략도 이 두 가지 종류의 복잡함을 분리하는 것 이었다.

기존 EJB는 결과적으로 그런 목표를 달성하는 데 실패했다.

선언적 트랜잭션이나 선언적 보안, 컨테이너를 통한 리모팅 기술의 적용, 컴포넌트 단위의 배치, JNDI를 통한 서비스 검색 지원 서비스 오브젝트의 풀링 컴포넌트 생명주기 관리 등은 EJB의 목표를 어느 정도
충족시켰다.

애플리케이션 로 직을 담은 핵심 코드에서 일부 기술적인 코드가 제거된 건 사실이지만, 오히려 EJB라는 환경과 스펙에 종속되는 코드로 만들어져야 하는 더 큰 부담을 안게 됐다.

EJB의 발전주기는 너무 느려서 엔터프라이즈 개발 기술의 발전을 따라잡지 못하는 것도 문제점이다.

> 비침투적인 방식을 통한 효과적인 해결책: 스프링
>

EJB처럼 어떤 기술을 적용했을 때 그 기술과 관련된 코드나 규약 등이 코드에 등장히는 경우를 침투적인(Invaslve) 기술이라고 한다.

꼭 필요한 기능을 시용하는 것도 아니면서 단지 어떤 기술을 바탕으로 만들어진다고 해서 특정 클래스나 인터페이스 API 등의 코드에 마구 등장한다면 그것은 침투적인 기술이 되며 복잡함을 가중시키는 원인이 된다.

반면에 비침투적인(non-invasive) 기술은 기술의 적용 사실이 코드에 직접 반영되지 않는다는 특정이 있다. 어딘가에는 기술의 적용에 따라 필요한 작업을 해줘야 하겠지만, 애플리케이션 코드 여기저기에 불쑥
등장하거나, 코드의 설계와 구현 방식을 제한하지는 않는다는 게 비침투적인 기술의 특정이다.

중요한 점은 그 과정에서 스프링 스스로가 애플리케이션 코드에 불필요하게 나타나지 않도록 하는 것이다.

스프링을 통해 성격이 다른 복잡함들을 깔끔하게 분리해줬기 때문에 각각을 효과적으로 상대할 수 있는 기반이 마련됐다.

동시에 스프링이 모드에 불필요하게 등장해서 부가적인 복잡함을 가져오지도 않았다. 이러한 전략 덕분에 비효율적인 개발에 대한 문제를 해결할 수 있게 되었다.

### 8.2.3 복잡함을 상대하는 스프링의 전략

스프링의 기본적인 전략은 비즈니스 로직을 담은 애플리케이션 코드와 엔터프라이즈 기술을 처리하는 코드를 분리시키는 것이다.

이 분리를 통해 두 가지 복잡함의 문제를 효과적으로 공략하게 해준다.

> 기술적 복잡함을 상대하는 전략
>

스프링은 엔터프라이즈 기술을 적용했을 때 발생하는 복잡함의 문제를 두 가지로 분류하고 각각에 대한 적절한 대응 방법을 제공한다.

- 첫 번째 문제: 기술에 대한 접근 방식이 일관성이 없고, 특정 환경에 종속적인 문제

일관성 없는 기술과 서버환경의 변화에 대한 스프링의 공략 방법은 바로 서비스 추상화이다.

기술적인 복잡함은 일단 추상회를 통해 로우레벨의 기술 구현 부분과 기술을 시용하는 인터페이스를 분리하고, 환경과 세부 기술에 독립적인 접근 인터페이스를 제공하는 것이 가장 좋은 해결책이다.

표준으로 자리 잡은 기술에 대해서도 서비스 추상화를 적용 할 필요가 있다. 이를 통해 태스트 편의성을 증대시키고 기술에 대한 세부 설정과 환경으로부터 독립적인 코드를 만들 수 있다.

스프링이 제공하는 템플릿/콜백 패턴은 판에 박힌 반복적인 작업 흐름과 API 사용 코드를 제거해준다. 이를 통해 기술을 사용하는 코드도 최적화된 핵심 로직에만 집중하도록 도외준다.

- 두 번째 문제: 기술적인 처리를 담당하는 코드가 성격이 다른 코드에 섞여서 등장하는 문제

책임에 따라 계층을 구분하고 그 사이에 서로의 기술과 특성에 의존적인 인터페이스나 예외처리 등을 최대한 제거한다고 할지라도 근본적으로 엔터프라이즈 서비스를 적용하는 한 이런 문제는 쉽게 해결할 수 없다. 이런 기술과
비즈니스 로직의 혼재로 발생하는 복잡함을 해결하기 위한 스프링의 접근 방법은 바로 AOP다.

AOP는 최후까지 애플리케이션 로직을 담당하는 코드에 남아 있는 기술 관련 코 드를 깔끔하게 분리해서 별도의 모률로 관리하게 해주는 강력한 기술이다.

AOP는 기술을 다루는 코드로 인한 복잡함이 기술 그 자체 이상으로 불필요하 게 증대되지 않도록 도와주는 가장 강력한 수단이다.

> 비즈니스와 애플리케이션 로직의 복잡함을 상대하는 전략
>

기술적인 코드, 침투적인 기술이 가져온 불필요한 흔적 등을 제거하고 나면 순수하게 애플리케이션의 주요 기능과 비즈니스 로직을 담은 코드만 독립적으로 존재하게 된다.

반면에 비즈니스 로직을 다루는 핵심 코드에 오류가 있으면 엔터프라이즈 시스템을 사용하는 업무 자체에 큰 지장을 주거나 치명적인 손실을 끼칠 수도 있다.

그래서 비즈니스 로직은 가장 중요하게 다뤄져야 하고 가장 많이 신경 써야한다.

엔터프라이즈 시스템의 규모가 커지고, 복잡함이 증가하면서 DB에 비즈니스 로직을 두는 것은 매우 불편할뿐더러 위험한 일이라고 여겨지기 시작했다.

가장 확장하기 힘들고 확장하더라도 많은 비용이 드는 공유 자원인 DB에 커다란 부담 을 주는 것도 문제고, 데이터 액세스를 중심으로 로직을 다루면 개발과 유지보수는 물론이고 테스트도 매우 어렵다.

엔터프라이즈 시스템 개발의 흐름은 점차로 비즈니스 로직은 애플라케이션 안에서 처리하도록 만드는추세다. DB는 단지 데이터의 영구적인 저장과 복잡한 조건을 가진 검색과 같은 자체적으로 특화된 기능에만 활용하고,
데이터를 분석하고 가공하고 그에 따라 로직을 처리하는 부분은 확장하기 쉽고, 비용도 싼 애플리케이션 서버 쪽으로 이동히는 것이다.

객체지향 프로그래밍 기법과 언어가 주는 장점인 유연한 설계가 가능하고 재사용성이 높다는 점을 잘 활용하면 자주 바뀌고 조건이 까다로운 비즈니스 로직을 효과적으로 구현해낼 수 있다.

환경에 종속적인 기술과 침투적인 기법으로 인해 추가된 군더더기에 방해만 받지 않는다면 객체지향 언어로서의 장점을 잘 살려 비즈니스 로직의 복잡함을 최대한 효과적으로 다룰수 있는 깔끔한 코드를 만드는건 어렵지 않다.

비침투적인 기술인 스프링은 핵심 로직을 다루는 코드인 비즈니스 로직을 담당하는 오브젝트들에게 적절한 엔터프라이즈 기술 서비스가 간접적으로 돕는다.

> 핵심 도구: 객체지향과 DI
>

기술과 비즈니스 로직의 복잡함을 해결하는데 스프링이 공통적으로 사용하는 도구가 있다. 바로 객제지향(OOP)이다.

자바의 기본인 객체지향에 충실한 설계가 가능하도록 단순한 오브젝트로 개발할 수 있고 객체지향의 설계 기법을 잘 적 용할 수 있는 구조를 만들기 위해 DI 같은 유용한 기술을 편하게 적용하도록 도와주는 것이 스프링의
기본 전략이다.

기술적인 복잡함을 효과적으로 다루게 해주는 기법은 모두 DI를 바탕으로 하고 있다. 서비스 추상화 템플릿/콜백 AOP와 같은 스프링의 기술은 DI 없이는 존재 할 수 없는 것 들이다.

DI는 자연스럽게 객체지향적인 설계와 개발로 이꿀어주는 좋은 동반자다.

DI를 의식하다 보면 오브젝트를 설계할 때 자주 DI를 적용할 후보가 더 이상 없을까를 생각해보게 된다.

결국 DI는 좋은 오브젝트 설계의 결과물이기도 하지만, 반대로 DI를 열심히 적 용하다 보면 객체지향 설계의 원칙을 잘 따르고 그 장점을 살린 설계가 나올 수도 있다.

기술적인 복잡함을 해결하는 문제나 기술적인 복잡함이 비즈니스 로직에 침범하지 못하도록 분리하는 경우에도 DI가 바탕이 된 여러 가지 기법이 활용된다.

비즈니스 로직 자체의 복잡함을 해결하려면 DI보다는 객체지향 설계 기법이 더 중요하다.

객체지향적인 특성을 잘 살린 설계는 상속과 다형성, 위임을 포함해서 많은 객체지향 디자인 패턴과 설계 기법이 잘 녹아들어갈 수있다. 기술적인 코드에 침범당하지 않았다면 이런 설계를 비즈니스 로직을 구현하는 코드에
그대로 반영할수 있다.

결국 모든 스프링의 기술과 전략은 객체지향이라는 자바 언어가 가진 강력한 도구를 극대화해서 사용할 수 있도록 돕는 것이라고 볼 수 있다.

현장의 업무를 잘 지원하고 유연하게 대응할 수 있는 뛰어난 애플라케이션을 만드는 것은 객체지향을 잘 활용해서 복잡한 문제를 풀어나갈 줄 아는 개발자의 능력에 달려 있다는 사실을 잊지 말아야 한다.

## 8.3 POJO 프로그래밍

스프링이 지향하는 목적이 무엇인지 정의해보기

스프링 핵심 개발자들은 “스프링의 정수는 엔터프라이즈 서비스 기능을 POJO에 제공하는 것”이라 한다.

엔터프라이즈 서비스라 하는 것은 보안, 트랜잭션과 같은 엔터프라이즈 시스템에서 요구되는 기술을 말한다.

기술을 POJO에 제공한다는 말은, 엔터프라이즈 서비스 기술과 POJO라는 애플리케이션 로직을 담은 코드를 분리했다는 뜻이기도 하다.

“분리됐지만 반드시 필요한 엔터프라이즈 서비스 기술을 POJO 방식으로 개발된 애플리케이션 핵심 로직을 담은 코드에 제공한다”는 것이 `스프링의 가장 강력한 특징과 목표`이다.

### 8.3.1 스프링의 핵심: POJO

`스프링의 핵심`이 POJO 프로그래밍이라는 사실은 스프링 삼각형이라는 이미지를 통해 알 수 있다.

스프링으로 개발한 애플리케이션의 기본 구조를 보면 스프링 애플리케이션은 POJO를 이용해서 만든 애플리케이션 코드와 POJO가 어떻게 관계를 맺고 동작하는지를 정의해놓은 설계정보로 구분된다.

스프링의 주요 기술인 IoC/DI, AOP와 PSA(Portable Service Abstraction)는 애플리케이션을 POJO로 개발할 수 있게 해주는 가능기술(enabling technology)이라고 불린다.

### 8.3.2 POJO란 무엇인가?

POJO는 Plain Old Java Object의 첫 글자를 따서 만든 약자다.

### 8.3.3 POJO의 조건

단순하게 보자면 그냥 평범한 자바 오브젝트라고 할 수 있지만, 좀 더 명확하게 하자면 적어도 디음의 세 가지 조건을 충족해야 POJO라고 불릴 수 있다.

> 특정 규약에 종속되지 않는다.
>

POJO는 자바 언어와 꼭 필요한 API 외에는 종속되지 않아야 한다.

특정 규약을 따라 만들게 하는 경우는 대부분 규약에서 제시하는 특정 클래 스를 상속하도록 요구한다.

자바의 단일 상속 제한 때문에 더 이상 해당 클래스에 객체지향적인 설계 기법을 적용하기가 어려워지는 문제가 생긴다.

규약이 적용된 환경에 종속적이 되기 때문에 다른 환경으로 이전이 힘들다는 문제점이 있다.

규약에 종속되지 않고, 객체지향 설계의 자유로운 적용이 가능한 오브젝트여야만 POJO라고 불릴 수 있다.

> 특정 환경에 종속되지 않는다.
>

특정 환경에 종속적이어야만 동작하는 오브젝트도 POJO라고 할 수 없다.

JDNI와 같은 특정 환경이 의존대상 검색 방식에 종속적이라면 POJO라고 할 수 없다.

특히 비즈니스 로직을 담고 있는 POJO 클래스는 웹이라는 환경정보나 웹 기술을 담고 있는 클래스나 인터페이스를 시용해서는 안 된다.

설령 나중에는 웹 컨트롤러와 연결돼서 사용될 것이 뻔하다고 할지라도 직접적으로 웹이라는 환경으로 제한해버리는 오브젝트나 API에 의존해선 안 된다.

웹 서버에 올리지 않고 독립적으로 태스트하기도 힘들어진다.

비즈니스 로직을 담은 코드에 HttpServletRequest나 HttpSession, 캐시와 관련된 API가 등장하거나 웹 프레임워크의 클래스를 직접 이용하는 부분이 있다면 그것은 진정한 POJO라고 볼 수 없다.

애노테이션이나 엘리먼트 값에 특정 기술과 환경에 종속적인 정보를 담고 있다면 그때는 POJO로서의 가치를 잃어버린다고 할 수 있다.

그렇다고 해서 특정 기술규약과 환경에 종속되지 않는다고해서 모두 POJO라고 할 수도 없다.

자바는 객체지향 프로그래밍을 가능하게 해주는 언어이지만, 자바 언어 문법을 사용했다고 해서 자동으로 객체지향 프로그래밍과 객체지향 설계가 적용됐다고 볼 수는 없다.

진정한 POJO란 객체지향적인 원리에 충실하면서, 환경과 기술에 종속되지 않고 필요에 따라 재활용될 수 있는 방식으로 설계된 오브젝트를 말한다.

### 8.3.4 POJO의 장점

POJO의 장점은 POJO가 될 수 있는 조건 그 자체가 장점이 된다.

특정한 기술과 환경에 종속되지 않는 오브젝트는 그 만큼 낄끔한 코드가 될 수 있다. 로우레벨의 기술과 환경에 종속적인 코드가 비즈니스 로직과 함께 섞여 나오는 것만큼 지저분하고 복잡한 코드도 없다.

POJO로 개발된 코드는 지동화된 테스트에 매우 유리하다. 어떤 환경에도 종속 되지 않은 POJO 코드는 매우 유연한 방식으로 원히는 레벨에서 코드를 빠르고 명확하게 테스트 할 수 있다.

객체지향적인 설계를 자유롭게 적용할 수 있다는 것도 큰 장점이다. 자바와 객체지향 프로그래밍, 모델링과 설계에 대해 배울 때 그려봤던 도메인 모댈과, 오랜 경험을 통해 쌓여온 재활용 가능한 설계 모델인 디자인 패턴
등은 POJO가 아니고는 적용하기 힘들다.

### 8.3.5 POJO 프레임워크

스프링은 POJO를 이용한 엔터프라이즈 애플리케이션 개발을 목적으로 하는 프레임워크라고 했다.

스프링 프레임워크와 하이버네이트를 대표적인 POJO 프레임워크로 꼽을 수 있다.

스프링은 엔터프라이즈 애플리케이션 개발의 모든 영역과 계층 에서 POJO 방식의 구현이 가능하게 하려는 목적으로 만들어졌다.

스프링을 이용하면 POJO 프로그래밍의 장점을 그대로 살려서 엔터프라이즈 애플라 케이션의 핵심 로직을 객체지향적인 POJO를 기반으로 깔끔하게 구현하고, 동시에 엔터프라이즈 환경의 각종 서비스와 기술적인 필요를
POJO 방식으로 만들어진 코드에 적용 할 수 있다.

스프링은 비즈니스 로직의 복잡함과 엔터프라이즈 기술의 복잡함을 분리해서 구성 할 수 있게 도와준다.

객체지향적 POJO 프로그래밍을 어떻게 효과적으로 적용할지는 개발자에게 또 하나의 숙제이고 부담이다. 개발자는 객체지향 분석과 설계에 대한 지식을 습득하고 훈련해야 한다. 객체지향 기술의 선구자들이 잘 정리해 놓은
디자인 패턴과 구현 패턴, 좀 더 나은 코드구조를 만들기 위한 리팩토링 기술 또한 필요하다.

스프링은 개발자들이 복잡한 엔터프라이즈 기술보다는 이러한 객체지향적인 설계와 개발의 원리에 좀 더 집중할 수 있도록 기회를 준다. 스프링이 제공하는 기술과, 프레임워크 API 및 확장 포인트는 그것을 이용하는 코드가
자연스럽게 객체지향적인 설계원리를 따라 가도록 이꿀어주기도 한다. 좋은 코드와 좋은 프레임워크의 특징은 그것을 사용해서 만들어지는 코드가 나쁜코드가 되기 어렵다는 점이다.

스프링은 자연스럽게 개발자가 좋은 코드를 만들 수 있도록 지원해주는 역할을 하고 있다.

## 8.4 스프링의 기술

“기술과 비즈니스 로직을 분리하고 POJO 방식의 애플리케이션 개발을 가능하게 한다”는 스프링의 목적을 쉽게 이루려면 스프링과 같은 POJO 프레임워크가 필요하다.

엔터프라이즈 개발에서 POJO 개발이 가능하려면 삼각형의 각 변을 이루고 있는 기술들이 뒷받침돼야 한다. 그 세 가지 기술은 바로 IoC/DI, AOP, PSA다.

객체지향의 설계와 개발 원리를 잘 적용하다보면 자연스럽게 만들어지는 것이기도 하다. 스프링을 특정 기술을 지원해주는 단순한 프레임워크로 이해하면 스프링의 목적과 가치를 놓치기 쉽다.

IoC/DI, AOP, PSA라는 것 자체가 이미 스프링이 중요한 가치를 두는 객체지향의 원리를 충실히 적용해서 나온 결과이기도 하다.

### 8.4.1 제어의 역전(IoC) / 의존관계 주입(DI)

IoC/DI는 스프링의 가장 기본이 되는 기술이자 스프링의 핵심 개발 원칙이기도 하다. 나머지 두 가지 기술인 AOP와 PSA도 IoC/DI에 바탕을 두고 있다.

3대 기술은 아니지만 자주 등장하는 템플릿/콜백 패턴이 적용된 부분도 IoC/DI가 그 핵심 원리다.

IoC/DI의 활용 방법을 생각해 보기 위해서는 이런 질문을 생각해 볼 수 있다. 왜 두 개의 오브젝트를 분리해서 만들고, 인터페이스를 두고 느슨하게 연결한 뒤, 실제 사용할 대상은 DI를 통해 외부에서 지정하는
것일까? 이렇게 DI방식으로 하는 것이 그렇지 않은 경우 즉, 직접 자신이 사용할 오브젝트를 new 키워드로 생성해서 사용하는 강한 결합을 쓰는 방법보다 나은 점은 무엇일까?

<aside>
💡 가장 간단한 답변은 “유연한 확장이 기능하게 하기 위해서”라고 할 수 있다.
</aside>

DI는 개방 폐쇄 원칙 OCP이라는 객체지향 설계 원칙으로 잘 설명될 수 있다.

유연한 확장이라는 장점은 OCP의 ‘확장에는 열려 있다(개방)’에 해당한다.

DI는 역시 OCP의 ‘변경에는 닫혀 있다(폐쇄)’라는 말로도 설명이 가능하다.

폐쇄 관점에서 볼 때 장점은 ‘재사용이 가능하다’라고 볼 수있다.

> DI의 활용 방법
>

조금 더 디테일한 DI의 활용 방식을 통해 그 장점을 생각해 보기

- 핵심기능의 변경

DI의 가장 대표적인 적용 방법은 바로 의존 대상의 구현을 바꾸는 것이다. 실제 의존하는 대상이 가진 핵심기능을 DI 설정을 통해 변경하는 것이 대표적인 DI의 활용방법이다.

- 핵심기능의 동적인 변경

의존 오브젝트의 핵심기능 자체를 바꾸는 것이다. 일반적인 DI를 이용한 변경 방법과는 달리, 동적으로 매번 다르게 변경할 수 있다. DI도 기본적으로는 런타임 시에 동적으로 의존 오브젝트를 연결해주는 것이긴 하지만,
일단 DI 되고 나면 그 후로는 바뀌지 않는다. DI를 잘 활용하면 애플리케이션이 동작하는 중간에 그 의존 대상을 다이내믹하게 변경할수 있다.

- 부가기능의 추가

DI의 세 번째 활용 방법은 핵심기능은 그대로 둔 채로 부가기능을 추가하는 것이다. 인터페이스를 두고 사용하게 하고, 실제 사용 할 오브젝트는 외부에서 주입하는 DI를 적용해두면 데코레이터 패턴을 쉽게 적용할 수
있다. 핵심기능과 클라이언트 코드에는 전혀 영향을 주지 않으면서 부가적인 기능을 얼마든지 추가할 수 있다.

부가 기능의 추가 방식을 특정 오브젝트가 아니라 좀 더 많은 대상으로 일반화해서 적용 하면 AOP가 된다.

부가기능을 추가할 수 있는 것도 바로 DI 덕분이다. DI 구조로 만들어놨기 때문에 가능한 것이며 DI의 핵심 원칙인 OCP에도 충실하게 잘 들어맞는다.

- 인터페이스의 변경

여러 종류의 인터페이스를 가졌지만 사실은 비슷한 기능을 담당하는 오브젝트를 바꿔가면서 사용하고 싶을 때도 있다. 클라이언트가 사용하는 인터페이스와 실제 오브젝트 사이에 인터페이스가 일치하지 않는 경우에도 DI가
유용하다.

디자인 패턴에서 말하는 오브젝트 방식의 어댑터 패턴의 응용이라고 볼 수있다.

인터페이스가 다른 다양한 구현을 같은 방식으로 사용하도록, 중간에 인터페이스 어댑터 역할을 해주는 레이어를 하나 추가하는 방법도 있다.

DI의 응용 방법 중 하나이자 스프링의 대표적인 기술로도 분류되는 일관성 있는 서비스 추상화( PSA )가 그런 방법이다.

PSA는 클라이언트가 일관성 있게 사용할 수 있는 인터페이스를 정의해주고 DI를 통해 어댑터 역할을 하는 오브젝트를 이용하게 해준다. 이를 통해서 다른 인터페이스를 가진 로우레벨의 기술을 변경하거나 확장해 가면서
사용할 수 있는 것이다.

- 프록시

프록시 패턴의 전형적인 응용 방법도 있다. 필요한 시점에서 실제 사용할 오브젝트를 초기화하고 리소스를 준비하게 해주는 지연된 로딩(lazy loading)을 적용하려면 프록시가 필요하다.

원격 오브젝트를 호출할 때 마치 로컬에 존재하는 오브젝트처럼 사용할 수 있게 해주는 원격 프록시를 적용하려고 할 때도 프록시가 필요하다.

두 가지 방식 모두 DI를 통해 이루어진다.

- 템플릿과 콜백

템플릿/콜백 패턴은 DI의 특별한 적용 방법이다. 반복적으로 등장하지만 항상 고정적인 작업 흐름과 그 사이에서 지주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들고 이를 DI 원리를 응용해 적용하면 지저분하게 매번
만들어야 하는 코드를 간결하게 만들 수 있다.

콜백을 템플릿에 주입하는 방식으로 동작하게 하는 것은 DI의 원리에 가장 충실한 응용 방법이다.

콜백을 얼마든지 만들어서 사용할 수 있다는 건 개방을 통한 유연한 확장성을 보여주는 것이며, 템플릿은 한 번 만들어두면 계속 재사용할 수 있다는 건 기능의 확장에도 변하지 않는다는 OCP의 폐쇄 원칙에 가장 잘
들어맞는 것이다.

- 싱글톤과 오브젝트 스코프

DI가 필요한 중요한 이유 중 한 가지는 DI할 오브젝트의 생명주기를 제어할 수 있다는 것이다. DI를 프레임워크로 이용한다는 건 DI 대상 오브젝트를 컨테이너가 관리한다는 의미다.

오브젝트의 생성부터 관계설정, 이용, 소멸에 이르기까지의 모든 과정을 DI 컨테이너가 주관하기 때문에 그 오브젝트의 스코프를 자유롭게 제어할수 있다.

상태를 갖지 않도록 만든 오브젝트가 동시에 여러 스레드의 요청을 처리하는 이런 방식을 적용하려면, 만들어지는 오브젝트의 개수를 제어하는 일이 매우 중요하다.

전통적인 싱글톤 패턴은 오브젝트에 많은 제약을 가해서 만들어지기 때문에 그다지 권장되지 않는다. 그보다는 컨테이너가 오브젝트를 관리하는 IoC 방식이 유용하다.

스프링의 DI는 기본적으로 싱글톤으로 오브젝트를 만들어서 사용하게 한다. 컨테이너가 알아서 싱글톤을 만들고 관리하기 때문에 클래스 자체는 싱글톤을 고려하지 않고 자유롭게 설계해도 된다는 장점이 있다.

스프링에서는 싱글톤 외에도 다양한 스코프를 갖는 오브젝트를 만들어 DI에 사용할 수도 있다. HTTP 요청당 하나의 오브젝트가 만들어지거나, HTTP 세션당 하나씩 오브젝트가 만들어지게 할 수 있다. 개발자 스스로
일정한 스코프를 갖는 오브젝트를 만들고 이를 DI에 적용하는 것도 기능하다. 오브젝트 스코프를 제어하는 방법 또한 DI를 적용했기 때문에 가능한 활용 방법이다.

- 테스트

마지막으로 살펴볼 DI의 중요한 용도는 바로 테스트다. 오브젝트와 협력해서 동작히는 오브젝트를 효과적으로 테스트하는 벙법은 기능한 한 고립시키는 것이다.

테스트할 대상이 의존하는 오브젝트를, 테스트를 목적으로 만들어진 목 오브젝트로 대체하면 유용하다.

의존 오브젝트를 대신해서 스텁 또는 목 오브젝트 같은 테스트 대역을 활용해야 한다. 이때도 DI는 중요한 역할을 한다. DI를 위해 만든 수정자 메소드를 사용하면 테스트 코드 안에서 수동으로 목 오브젝트를 주입할 수
있다. 또는 테스트용 으로 설정을 별도로 만드는 방법도 있다.DI 없이는 이런 테스트 기법을 적용하기란 불가능하다.

DI의 활용 방법은 다양하다. DI의 용도는 디자인 패턴 중에서 오브젝트 합성 방식을 따르는 패턴과 관련이 있음을 알 수 있다.

GoF의 디자인 패턴 중에서 인터페이스를 두고 오브젝트를 분리하는 구조를 가진 오브젝트 스코프의 패턴은 DI의 구조에 대부분 잘 들어맞는다.

그런 패턴의 장점들을 애플리케이션 전 영역에서 간단한 설정만으로 자연스럽게 적용할 수 있게 만들어주는 것이 바로 DI다.

하나의 DI 대상에 대해 핵심기능도 업무 변화에 따라 바꾸면서, 부가기능도 여러 개 추가해넣고, 테스트에서도 활용하는 식으로 사용해도 된다.

### 8.4.2 애스펙트 지향 프로그래밍(AOP)

애스펙트 지향 프로그래밍은 객체지향 프로그래밍(OOP)처럼 독립적인 프로그래밍 패러다임이 아니다. AOP와 OOP는 서로 배타적이 아니라는 말이다.

객체지향 기술은 매우 성공적인 프로그래밍 방식임에 분명하다. 하지만 한편으로는 점점 복잡해져 가는 애플리케이션의 요구조건과 기술적인 난해함을 모두 해결하는 데 한계가 있기도 하다. AOP는 바로 이러한 객체지향
기술의 한계와 단점을 극복하도록 도와주는 보조적인 프로그래밍 기술이다.

스프링의 목적인 POJO만으로 엔터프라이즈 애플리케이션을 개발하면서도 엔터프라이즈 서비스를 선언적으로 제공하는 데 반드시 필요한 것이 바로 AOP 기술이다. IoC/DI를 이용해서 POJO에 선언적인 엔터프라이즈
서비스를 제공할 수 있지만 일부 서비스는 순수한 객체지향 기법만으로는 POJO의 조건을 유지한 채로 적용하기 힘들다. 바로 이런 문제를 해결하기 위해 AOP가 필요하다.

> AOP의 적용 기법
>

AOP를 자바 언어에 적용하는 기법은 크게 두 가지로 분류할 수 있다.

- 첫 번째 스프링과 같이 다이내믹 프록시를 사용하는 방법

기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 테코레이터 패턴을 응용한 것이다. 자바의 객체지향 패턴을 활용한 방법이기 때문에 만들기 쉽고 적용하기 간편하다.

대신 부가기능을 부여할 수 있는 곳은 메소드의 호출이 일어나는 지점뿐이라는 제약이 있다. 부가기능을 구현한 코드나 기능을 적용할 대상을 찾는 방법 모두 평범한 자바 클래스로 만들면 된다.

엔터프라이즈 개발에서 필요로 하는 AOP는 대부분이 다이나믹 프록시를 이용하는 프록시 방식의 AOP이다.

- 두 번째 자바 언어의 한계를 넘어서는 언어의 확장을 이용하는 방법

AspectJ는 강력한 고급 기능을 가진 AOP를 제공한다. AspectJ는 프록시 방식의 AOP에서는 불가능한 다양한 조인 포인트를 제공한다. 메소드 호출뿐 아니라 인스턴스 생성, 필드 액세스, 특정 호출 경로를
가진 메소드 호출 등에도 부가기능을 제공할 수 있다.

하지만 AOP 컴파일러를 이용한 빌드 과정을 거치거나, 클래스가 메모리로 로딩될 때 그 바이트 코드를 조작하는 위빙과 같은 별도의 방법을 이용해야 한다.

스프링은 프록시 방식의 AOP를 기본으로 하고 있지만, 원한다면 AspectJ를 이용한 AOP로 바꿔서 시용할 수 있다. 스프링의 특별한 기능 중에는 AspectJ를 꼭 시용해야 하는 것도 있다.

> AOP의 적용 단계
>

AOP의 장점이 많다고해서 무작정 사용 하면 심각한 문제가 발생할 위험이 있다. 개발자 개개인이 아무렇게나 AOP를 남발해 서 사용하다 보면 다른 개발자가 만든 코드가 예상하지 않은 방식으로 돌아가는 등의 혼란을
초래할 수 있기 때문이다.

AOP에 익숙하지 않은 상태라면 차근차근 단계를 밟아 AOP를 도입하는 접근 방법이 좋다.

- AOP 적용 1단계: 미리 준비된 AOP 이용

처음에는 스프링이 미리 만들어서 제공하는 AOP 기능을 그대로 가져다 적용하는 방식으로 학습한다. 스프링이 직접 제공하는 대표적인 AOP는 바로 트랜잭션이다.

AOP 설정을 통해서 트랜잭션이 어떻게 많은 오브젝트에 투명하게 적용되는지 관찰해보고, AOP의 특성과 동작원리를 이해하는 식으로 접근한다.

스프링에는 트랜잭션만큼 자주 사용되진 않지만 특정 아커텍처를 선택했을 때, 사용할 수 있도록 준비된 AOP 기능이 하나 더 있다. @Configurable 애노테이션을 이용해서 도메인 오브젝트에 DI를 자동
적용해주는 AOP 기능이다.

도메인 오브젝트를 전용 계층에 두고 접근하는 아키텍처 방식을 따를 때 반드시 필요하다. 프록시 AOP면 충분한 트랜잭션과 달리, @Configurable을 위해서는 AspectJ를 이용한 AOP가 반드시 필요하다.

두 가지 모두 간단한 설정을 추가하는 것만으로도 쉽게 적용되기 때문에 AOP에 대한 지식이나 경험이 많지 않더라도 간단히 이용가능하다는 장점이 있다.

- AOP 적용 2단계: 전담팀을 통한 정책 AOP 적용

애플라케이션 전체적으로 이용 가능한 것을 소수의 AOP 담당자 관리하에 적용해볼 수 있다.

대표적으로 비즈니스 로직을 가진 오브젝트에 대한 보안, 특정 계층의 오브젝트 이용 전후의 작업 기록을 남 기는 로깅, 데이터 추적을 위한 트레이싱, 특정 구간의 실시간 성능 모니터링과 같은 정책적으로 적용할 만한
기능에 AOP를 이용하는 것이다.

기존 코드에는 당연히 아무런 영향을주지 않으면서 AOP를 언제든지 기능을 추가하거나 제거할 수 있다. 이런 특징을잘 이용하면 운영 중에 필요한기능 외에 개발 가이드라인이나 표준을 따라서 코드가 작성되어 있는지를
검증하는 작업을 AOP를 이용해 할 수 있다.

AOP는 동적으로 동작하면서 개발 정책을 위반한 코드를 잡아내는 데도 유용하다.

- AOP 적용 3단계: AOP의 자유로운 이용

애플리케이션 전체적으로 적용되는 정책 AOP를 위주로 했다면 이제는 개발자가 구현하는 기능에 적용하면 유용한 세부적인 AOP를 이용할 수 있다.

### 8.4.3 포터블 서비스 추상화(PSA)

세 번째 가능기술은 환경과 세부 기술의 변화에 관계없이 `일관된 방식`으로 기술에 접근할 수 있게 해주는 PSA(Portable Service Abstraction)다.

POJO로 개발된 모드는 특정 환경이나 구현 방식에 종속적이지 않아야 한다.

특정 환경과 기술에 종속적이지 않다는게 그런 기술을 사용하지 않는다는 뜻은 아니다. 다만 POJO 코드가 그런 기술에 직접 노출되어 만들어지지 않는다는 말이다.

이를 위해 스프링이 제공하는 대표적인 기술이 바로 일관성 있는 서비스 추상화 기술이다.

스프링은 엔터프라이즈 개발에 사용되는 다양한 기술에 대한 서비스 추상화 기능을 제공한다.

AOP나 탬플릿/콜백 패턴과 결합돼서 사용되기 때문에 직접적으로 서비스를 이용할 필요가 없다.

트랜잭션 서비스 추상회는 코드를 이용해 트랜잭션을 제어하지 않는다면 직접 이용할 이유가 없다. 트랜잭션은 대부분 AOP를 이용해 적용하기 때문에 직접 코드를 만들지 않는다. 대신 설정에서 스프링의 트랜잭션 추상화
인터페이스인 PlatformTransactionManager를 구현한 구체적인 서비스 클래스를 빈으로 등록해줘야 한다.

직접 스프링이 제공하는 API를 사용해서 만드는 경우도 있다. OXM이나 JavaMail을 이용한다면 스프링이 정의한 추상 API를 이용해 코드를 작성한다. 그리고 구체적인 기술과 설정은 XML 파일 안에서
지정한다.

스프링의 서비스 추상화의 개념과 장점을 잘 이해한다면 때에 따라 직접 서비스 추상화 기법을 적용할 필요도 있다.

서비스 추상회를 위해 펼요한 기술은 DI뿐이다. 결국 DI 응용 방법의 한 가지이므로 DI를 적극 활용해서 개발한다면 서비스 추상화는 자연스럽게 만들어 쓸 수 있다.

서비스 추상회는 단지 구체적인 기술에 종속되지 않게 하기 위해서만 사용되는 건 아니다. 테스트가 어렵게 만들어진 API나 설정을 통해 주요 기능을 외부에서 제어하게 만들고 싶을 때도 이용할 수 있다.

## 8.5 정리

스프링의 기본적인 정의와 그 목적 그리고 그것을 이루기 위해 제공하는 기술을 정리했다.

스프링의 상세한 기술을 공부하기 전에 먼저 이해하고 기억해야 할 사항

- 스프링은 개발 철학과 목표를 분명히 이해하고 사용해야 한다.
- 스프링은 오픈소스 소프트웨어이며, 애플리케이션 개발의 모든 기술과 영역을 종합적으로 다루는 애플리케이션 프레임워크이다.
- 엔터프라이즈 애플리케이션 개발의 `복잡함`은 `비즈니스 로직`과 `엔터프라이즈 시스템의 기술적인 요구`에 의해 발생한다. 기존의 접근 방법은 이러한 복잡도를 낮추지 못하며 자바의 객체지향적인
  장점을 포기해야 한다는 문제점이 있다.
- 자바의 근본인 객체지향적인 원리에 충실하게 개발할 수 있으며, 환경과 규약에 의존적이지 않은 `POJO를 이용한 애플리케이션 개발`은 엔터프라이즈 시스템 개발의 복잡함이 주는 많은 문제를 해결할 수 있다.
- 스프링의 목적은 POJO를 이용해 엔터프라이즈 애플리케이션을 쉽고 효과적으로 개발 할 수 있도록 지원해주는 데 있다.
- POJO 방식의 개발을 돕기 위해 스프링은 IoC/DI, AOP, PSA와 같은 가능기술을 프레임워크와 컨테이너라는 방식을 통해 제공한다.

스프링을 가장 잘 이해하기 위한 방법은 `엔터프라이즈 개발이 주는 복잡함을 제거`하고, `POJO 프로그래밍`이라는 효과적인 방법을 사용할 수 있게 하는지 관심을 갖는 것이다.